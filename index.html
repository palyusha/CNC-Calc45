<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    
    <title>Huron Master PRO</title>
    
    <style>
        /* Общие настройки для исключения свайпа */
        * { box-sizing: border-box; } 
        
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: #000; color: #eee; margin: 0; 
            display: flex; flex-direction: column; height: 100vh; overflow: hidden; 
        }
        
        #sidebar { 
            width: 100%; max-width: 100vw; background: #1a1a1a; padding: 10px; 
            border-bottom: 2px solid #ffcc00; overflow-x: hidden; 
        }
        
        @media (min-width: 768px) {
            body { flex-direction: row; }
            #sidebar { width: 380px; height: 100vh; border-bottom: none; border-right: 2px solid #ffcc00; }
        }

        .card { background: #262626; padding: 10px; border-radius: 12px; margin-bottom: 8px; border: 1px solid #333; }
        h3 { color: #ffcc00; font-size: 0.75em; margin: 0 0 8px 0; text-transform: uppercase; text-align: center; }

        .angle-control { display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        .step-btn { 
            background: #333; color: #ffcc00; border: 1px solid #444; 
            width: 55px; height: 55px; border-radius: 12px; 
            font-size: 1.6em; font-weight: bold; cursor: pointer;
            user-select: none; -webkit-user-select: none;
        }

        input, select { 
            background: #000; border: 1px solid #444; color: #0f0; 
            padding: 8px; font-size: 1em; text-align: center; border-radius: 8px; outline: none;
        }
        
        .main-angle-input { font-size: 2em; border-color: #ffcc00; color: #ffcc00; font-weight: bold; width: 110px; }

        /* КОМПАКТНЫЙ ИНСТРУМЕНТ */
        .tool-inputs { display: flex; gap: 6px; justify-content: center; }
        .tool-col { flex: 1; min-width: 0; } /* min-width: 0 позволяет flex-элементам сжиматься правильно */
        .tool-col label { font-size: 0.6em; color: #888; display: block; text-align: center; margin-bottom: 3px; }
        .tool-col input { width: 100%; padding: 8px 4px; font-size: 0.9em; }

        table { width: 100%; border-collapse: collapse; }
        td { padding: 5px; border: 1px solid #333; text-align: center; }
        .res-label { font-size: 0.6em; color: #888; }
        .res-val { font-weight: bold; font-family: monospace; color: #fff; font-size: 1.1em; }
        
        #viewport { flex: 1; display: flex; align-items: center; justify-content: center; background: #000; }
        svg { width: 95%; height: 95%; max-height: 35vh; }
        @media (min-width: 768px) { svg { max-height: 80vh; } }

        .btn-save { background: #ffcc00; color: #000; border: none; padding: 12px; width: 100%; font-weight: bold; border-radius: 8px; margin-top: 8px; font-size: 0.9em; }
        #toolLog { font-size: 0.7em; margin-top: 8px; max-height: 100px; overflow-y: auto; }
    </style>
</head>
<body>

<div id="sidebar">
    <select id="langSel" onchange="run()" style="margin-bottom: 10px; font-size: 0.9em;">
        <option value="ru">Русский</option>
        <option value="en">English</option>
        <option value="de">Deutsch</option>
    </select>

    <div class="card">
        <h3 id="hA">Угол детали</h3>
        <div class="angle-control">
            <button class="step-btn" onmousedown="startStep(-0.1)" onmouseup="stopStep()" ontouchstart="startStep(-0.1)" ontouchend="stopStep()">−</button>
            <input type="number" id="inpAngle" value="28.0" step="0.1" inputmode="decimal" class="main-angle-input" oninput="run()">
            <button class="step-btn" onmousedown="startStep(0.1)" onmouseup="stopStep()" ontouchstart="startStep(0.1)" ontouchend="stopStep()">+</button>
        </div>
    </div>

    <div class="card">
        <h3 id="hT">Инструмент</h3>
        <div class="tool-inputs">
            <div class="tool-col">
                <label id="lL">Длина L</label>
                <input type="number" id="toolL" value="150" inputmode="decimal" oninput="run()">
            </div>
            <div class="tool-col">
                <label id="lD">Диам. D</label>
                <input type="number" id="toolD" value="50" inputmode="decimal" oninput="run()">
            </div>
        </div>
        <button class="btn-save" id="btnS" onclick="addTool()">СОХРАНИТЬ</button>
    </div>

    <div class="card">
        <h3 id="hS">Лимбы Huron</h3>
        <table>
            <tr><td class="res-label">C</td><td class="res-label">B</td></tr>
            <tr><td id="outC" class="res-val" style="color:#00a2ff;">-126.9°</td><td id="outB" class="res-val" style="color:#00ff6a;">93.5°</td></tr>
        </table>
    </div>

    <div class="card">
        <h3 id="hD">Дельты (XYZ)</h3>
        <table style="color:#ffcc00;">
            <tr><td id="dX" class="res-val">0.00</td><td id="dY" class="res-val">0.00</td><td id="dZ" class="res-val">0.00</td></tr>
        </table>
    </div>

    <div id="toolLog"></div>
</div>

<div id="viewport">
    <svg viewBox="0 0 400 400">
        <line x1="20" y1="360" x2="380" y2="360" stroke="#333" stroke-width="2" />
        <g transform="translate(200, 100)">
            <g id="headGroup">
                <path d="M-30,0 L30,0 L0,50 Z" fill="#222" stroke="#00ff6a" />
                <rect id="vTool" fill="rgba(255, 204, 0, 0.6)" stroke="#ffcc00" />
                <g id="vDetail">
                    <line x1="-150" y1="0" x2="150" y2="0" stroke="#00a2ff" stroke-width="3" stroke-dasharray="5" />
                </g>
            </g>
        </g>
    </svg>
</div>

<script>
/* (Весь JavaScript остается без изменений, как в нашем стандарте) */
const texts = {
    ru: {hA:"Угол детали", hT:"Инструмент", hS:"Лимбы Huron", hD:"Дельты (XYZ)", lL:"Длина L", lD:"Диам. D", btnS:"СОХРАНИТЬ"},
    en: {hA:"Part Angle", hT:"Tool", hS:"Huron Scales", hD:"Offsets (XYZ)", lL:"Length L", lD:"Diam. D", btnS:"SAVE"},
    de: {hA:"Werkstückwinkel", hT:"Werkzeug", hS:"Huron Skalen", hD:"Deltas (XYZ)", lL:"Länge L", lD:"Durchm. D", btnS:"SPEICHERN"}
};

let stepInterval = null;
let stepTimeout = null;

function step(val) {
    let el = document.getElementById('inpAngle');
    let current = parseFloat(el.value) || 0;
    el.value = (current + val).toFixed(1);
    run();
}

function startStep(val) {
    step(val);
    stepTimeout = setTimeout(() => {
        stepInterval = setInterval(() => step(val), 80);
    }, 400);
}

function stopStep() {
    clearTimeout(stepTimeout);
    clearInterval(stepInterval);
}

function run() {
    let ln = document.getElementById('langSel').value;
    for(let key in texts[ln]) {
        let el = document.getElementById(key);
        if(el) el.innerText = texts[ln][key];
    }

    let a = parseFloat(document.getElementById('inpAngle').value) || 0;
    let L = parseFloat(document.getElementById('toolL').value) || 0;
    let D = parseFloat(document.getElementById('toolD').value) || 0;

    let aCalc = 90 - a; 
    let r = aCalc * Math.PI / 180;
    let cB = Math.max(-1, Math.min(1, 2 * Math.cos(r) - 1));
    let B = Math.acos(cB) * 180 / Math.PI;
    let C = (Math.abs(aCalc) > 0.01) ? (Math.acos(Math.tan(r / 2)) * 180 / Math.PI - 180) : -180;

    document.getElementById('outB').innerText = B.toFixed(1) + "°";
    document.getElementById('outC').innerText = C.toFixed(1) + "°";

    let tiltRad = a * Math.PI / 180;
    let dx = L * Math.sin(tiltRad);
    let dz = L * (1 - Math.cos(tiltRad));
    let dy = dx * Math.sin(C * Math.PI / 180);
    let dx_f = dx * Math.cos(C * Math.PI / 180);

    document.getElementById('dX').innerText = dx_f.toFixed(2);
    document.getElementById('dY').innerText = dy.toFixed(2);
    document.getElementById('dZ').innerText = dz.toFixed(2);

    let vt = document.getElementById('vTool');
    vt.setAttribute('width', D);
    vt.setAttribute('x', -D/2);
    vt.setAttribute('y', 55);
    vt.setAttribute('height', L);
    document.getElementById('vDetail').setAttribute('transform', `translate(0, ${55 + L})`);
    document.getElementById('headGroup').setAttribute('transform', `rotate(${-a} 0 0)`);
}

window.onload = run;
</script>
</body>
</html>
